@using PortfolioWebsite.BlazorUI.Models.Navigation
@inject IArticleService articleService;
@inject ITextParserService textParserService;

@if(this.NavigationMenu is null)
{
    return;
}

<nav class="navbar main-background-color navbar-expand-md fixed-top">
    <div class="container-fluid">
        <a class="navbar-brand main-color clickable-1 scale-up vp-anim-1" href="" @onclick="() => { CollapseNavMenu(); }">
          @title
        </a>

        <button class="navbar-toggler main-outline border-0 fade-in-with-right-translate" @onclick="ToggleNavMenu" type="button">
            <span class="@NavMenuIcon infinite-zoom-in-out main-color"></span>
        </button>

        <div class="flex-md-row-reverse fullscreen-menu fullscreen-menu-vertical @(NavMenuVisibility)" id="main-navbar">
            <ul class="navbar-nav fullscreen-menu-content" id="main-navbar-content">
                @foreach (var navElement in this.NavigationMenu?.NavigationLinks)
                {
                    <li class="nav-item vp-anim-3">
                        <a class="nav-link main-color clickable-2 selectable-item"
                           href="@navElement.PageRef"
                           @onclick="() => { CollapseNavMenu(); }">@(navElement.Label)</a>

                    </li>
                }
            </ul>
        </div>
    </div>
</nav>

@code {
    // TODO: Highlight currently selected nav (event when navigating directly to that page)
    private MarkupString title;
    private bool isNavMenuCollapsed { get; set; } = true;
    private string NavMenuVisibility => isNavMenuCollapsed ? "" : "wipe-down";
    private string NavMenuIcon => isNavMenuCollapsed ? this.NavigationMenu?.CollapsedMenuIcon : this.NavigationMenu?.OpenMenuIcon;

    private NavigationMenuInfoModel NavigationMenu;

    protected async override Task OnInitializedAsync()
    {
        this.NavigationMenu = await articleService.GetNavigationMenuAsync();
        this.title = textParserService.Parse(this.NavigationMenu?.Title);
    }

    void ToggleNavMenu()
    {
        isNavMenuCollapsed = !isNavMenuCollapsed;
    }

    void CollapseNavMenu()
    {
        isNavMenuCollapsed = true;
    }
}

